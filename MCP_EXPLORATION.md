# 我们在 MCP Server 上的一些探索

## 环信文档搜索 MCP 服务实践

我们基于 FastMCP 框架开发了环信文档搜索服务，这是一个专门用于查询环信SDK、UIKit和CallKit文档的MCP服务。通过这个项目，我们探索了MCP服务在文档检索和内容分析领域的应用潜力。

### 基于 FastMCP 的实现选择

我们选择 FastMCP 作为开发框架，主要基于以下考虑：

1. **Python生态系统的优势**：Python在文本处理、数据分析方面有丰富的库支持，非常适合文档处理任务。
2. **简洁的API设计**：FastMCP提供了装饰器风格的API，使得工具函数的定义和注册变得简单直观。
3. **多种传输协议支持**：FastMCP原生支持HTTP、SSE和STDIO三种传输模式，满足不同场景的需求。

### 多种连接模式的实践体验

在项目中，我们实现了三种连接模式，每种模式都有其特定的应用场景：

#### STDIO模式

```python
# 启动STDIO模式
mcp.run(transport="stdio")
```

**实践体验**：
- 在本地开发和调试过程中，STDIO模式表现出色，延迟极低。
- 无需担心网络配置，直接在本地进程间通信，简化了开发环境设置。
- 特别适合与Cursor等IDE工具集成，用户无需手动启动服务，系统会按需启动。
- 安全性高，数据不经过网络传输，适合处理敏感文档。

#### HTTP模式

```python
# 启动HTTP模式
mcp.run(
    transport="http",
    host="0.0.0.0",
    port=443,
    path="/mcp/"
)
```

**实践体验**：
- 提供了最广泛的兼容性，几乎所有客户端都能通过HTTP协议连接。
- 在分布式环境中表现良好，支持多客户端同时访问。
- 可以轻松集成到现有的Web服务架构中，如通过Nginx反向代理。
- 相比STDIO模式，存在一定的网络延迟，但在局域网环境中影响不大。

#### SSE模式

```python
# 启动SSE模式
mcp.run(
    transport="sse",
    host="0.0.0.0",
    port=443,
    path="/mcp/"
)
```

**实践体验**：
- 在需要服务器主动推送更新的场景中表现优异，如实时文档更新提醒。
- 单向通信模式简化了服务端实现，减少了双向通信的复杂性。
- 自动重连机制提高了连接的可靠性，特别是在网络不稳定环境下。
- 在高并发场景下需要注意服务器资源管理，大量长连接可能导致资源压力。

### 文档搜索工具的实现亮点

我们实现的两个核心工具函数展示了MCP服务的强大能力：

1. **search_platform_docs**：通过灵活的参数设计，支持多种文档类型和平台的精确匹配，甚至支持部分匹配和常用词语映射，大大提升了用户体验。

2. **get_document_content**：不仅能获取文档内容，还能进行关键词搜索并返回上下文，这种上下文感知的搜索功能对AI助手理解文档内容至关重要。

### 与AI交互的最佳实践

通过实践，我们总结出以下与AI交互的最佳实践：

1. **渐进式搜索策略**：先通过广泛搜索确定相关文档，再通过关键词精确定位内容，最后获取完整上下文。

2. **上下文保留**：在返回搜索结果时，保留足够的上下文（前后各2行），帮助AI更好地理解文档内容。

3. **错误处理机制**：每个工具函数都有完善的错误处理，确保即使在文档不存在或搜索失败的情况下，也能返回有意义的错误信息。

4. **灵活的参数设计**：支持多种输入形式（如单个字符串或字符串列表），减少了用户输入的复杂性。

### 部署与维护经验

在实际部署过程中，我们积累了宝贵的经验：

1. **多种部署选项**：提供了systemd服务、Docker容器和Supervisor三种部署方案，适应不同的服务器环境。

2. **自动更新机制**：通过cron任务定期从GitHub拉取最新文档，确保文档内容的时效性。

3. **资源优化**：针对不同的传输模式，调整了服务器的资源配置，如HTTP模式下的并发连接数、SSE模式下的超时设置等。

4. **监控与日志**：实现了详细的日志记录，便于问题排查和性能优化。

## 未来展望

基于我们的探索，环信文档搜索MCP服务还有以下发展方向：

1. **语义搜索能力**：引入向量数据库和嵌入模型，实现基于语义的文档搜索，而不仅仅是关键词匹配。

2. **多语言支持**：扩展服务以支持多语言文档的搜索和内容提取。

3. **交互式文档导航**：实现更智能的文档导航功能，如根据用户问题自动推荐相关文档。

4. **实时更新通知**：利用SSE模式的特性，在文档更新时主动通知用户。

通过这个项目，我们不仅构建了一个实用的文档搜索服务，也深入探索了MCP协议在实际应用中的潜力和最佳实践，为未来更多MCP服务的开发积累了宝贵经验。
