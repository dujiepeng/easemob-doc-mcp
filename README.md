# ç¯ä¿¡æ–‡æ¡£æœç´¢ MCP æœåŠ¡ (Easemob Doc MCP)

è¿™æ˜¯ä¸€ä¸ªåŸºäº [FastMCP](https://github.com/jlowin/fastmcp) æ„å»ºçš„ MCP (Model Context Protocol) æœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ© LLM (å¦‚ Claude, Cursor) å¿«é€Ÿæ£€ç´¢å’Œç†è§£ç¯ä¿¡ (Easemob) çš„æŠ€æœ¯æ–‡æ¡£ã€‚

å®ƒé›†æˆäº† **Whoosh å…¨æ–‡æœç´¢å¼•æ“** å’Œ **jieba ä¸­æ–‡åˆ†è¯**ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€é—®ç­”å’Œç²¾ç¡®çš„æ–‡æ¡£å®šä½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **ğŸ” å…¨æ–‡æ™ºèƒ½æœç´¢** (`search_knowledge_base`):
    *   æ”¯æŒè‡ªç„¶è¯­è¨€æé—®ï¼ˆå¦‚ "Android ç™»å½•å¤±è´¥æ€ä¹ˆæ’æŸ¥ï¼Ÿ"ï¼‰ã€‚
    *   åŸºäº BM25 ç®—æ³•çš„ç›¸å…³æ€§æ’åºã€‚
    *   ç²¾å‡†çš„ä¸­æ–‡åˆ†è¯ä¸é«˜äº®æ‘˜è¦è¿”å›ã€‚
*   **ğŸ“‚ ç›®å½•ç»“æ„æµè§ˆ** (`search_platform_docs`):
    *   æµè§ˆ SDK, UIKit, CallKit çš„ç‰¹å®šå¹³å°æ–‡æ¡£ç»“æ„ã€‚
*   **ğŸ”„ docker è‡ªåŠ¨æ›´æ–°**:
    *   Docker å®¹å™¨å†…ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©è‡ªåŠ¨æ‹‰å–æœ€æ–°æ–‡æ¡£ (`git pull`) å¹¶é‡å»ºç´¢å¼•ã€‚

## ğŸ› ï¸ Docker éƒ¨ç½² (æ¨è)

æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼æ˜¯ä½¿ç”¨ Dockerã€‚æˆ‘ä»¬æä¾›äº†å¼€ç®±å³ç”¨çš„é…ç½®ã€‚

### 1. å¯åŠ¨æœåŠ¡

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
docker-compose up --build -d
```

*   æœåŠ¡å°†åœ¨ `9000` ç«¯å£å¯åŠ¨ (SSE æ¨¡å¼)ã€‚
*   é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨æ„å»ºå…¨æ–‡ç´¢å¼•ï¼ˆçº¦éœ€å‡ ç§’é’Ÿï¼‰ã€‚

### 2. å¤–ç½‘è®¿é—® (å¯é€‰)

é…ç½®ä¸­å·²é›†æˆ **Cloudflare Tunnel**ï¼Œå¯åŠ¨åä¼šè‡ªåŠ¨å»ºç«‹å®‰å…¨éš§é“ï¼Œä»¥ä¾¿æ‚¨åœ¨å…¬ç½‘ç¯å¢ƒä¸‹ä¹Ÿèƒ½è®¿é—®æ­¤ MCP æœåŠ¡ã€‚

1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š
   ```bash
   CLOUDFLARE_TUNNEL_TOKEN=æ‚¨çš„éš§é“Token
   ```
2. è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨åŒ…å«éš§é“çš„å…¨é‡æœåŠ¡ï¼š
```bash
docker-compose up -d
```

### 2. è‡ªåŠ¨æ›´æ–°æœºåˆ¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¼š **æ¯ 24 å°æ—¶** æ‰§è¡Œä¸€æ¬¡ `git pull`ï¼š
*   å¦‚æœæ£€æµ‹åˆ°æ–‡æ¡£æ›´æ–°ï¼šè‡ªåŠ¨é‡å»ºç´¢å¼• + æ¸…ç†ç¼“å­˜ã€‚
*   å¦‚æœæ— æ›´æ–°ï¼šé™é»˜å¾…æœºã€‚

æ‚¨å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´æ›´æ–°é¢‘ç‡ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼š

```bash
# ä¾‹å¦‚ï¼šæ¯ 1 å°æ—¶æ›´æ–°ä¸€æ¬¡
export DOC_UPDATE_INTERVAL_SECONDS=3600
docker-compose up -d
```

### 3. Docker æ¨¡å¼ä¸‹çš„æœ¬åœ°é“¾æ¥

åœ¨ `docker-compose.yml` ä¸­ï¼Œæˆ‘ä»¬å°†å½“å‰ç›®å½•æŒ‚è½½åˆ°äº†å®¹å™¨çš„ `/app` ç›®å½•ï¼š

```yaml
volumes:
  - .:/app
```

è¿™æ„å‘³ç€ï¼š
*   **åŒå‘åŒæ­¥**ï¼šå®¹å™¨å†…å¯¹æ–‡æ¡£çš„æ›´æ–°ï¼ˆ`git pull`ï¼‰å’Œç´¢å¼•çš„æ„å»ºä¼šç›´æ¥åæ˜ åœ¨å®¿ä¸»æœºçš„ç£ç›˜ä¸Šã€‚
*   **å¼€å‘ä¾¿åˆ©**ï¼šæ‚¨å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šç›´æ¥ä¿®æ”¹ `src/` ä¸‹çš„ä»£ç ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨åº”ç”¨è¿™äº›æ›´æ”¹ï¼ˆå¦‚æœä½¿ç”¨äº†æ”¯æŒçƒ­é‡è½½çš„æœºåˆ¶ï¼Œæˆ–è€…é‡å¯å®¹å™¨ `docker-compose restart`ï¼‰ã€‚
*   **ç¯å¢ƒä¸€è‡´**ï¼šå³ä¾¿åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œåªè¦è¿è¡Œ Dockerï¼Œå°±èƒ½è·å¾—å®Œå…¨ä¸€è‡´çš„æœç´¢ç¯å¢ƒå’Œä¾èµ–é…ç½®ã€‚

## ğŸ”Œ MCP Client ä½¿ç”¨æŒ‡å—

éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨å¯ä»¥å°†æ­¤æœåŠ¡è¿æ¥åˆ°æ”¯æŒ MCP çš„å®¢æˆ·ç«¯ã€‚

### Cursor ä½¿ç”¨

1.  æ‰“å¼€ Cursor è®¾ç½® -> **Features** -> **MCP Servers**ã€‚
2.  ç‚¹å‡» **+ Add new MCP server**ã€‚
3.  å¡«å†™é…ç½®ï¼š
    *   **Name**: `Easemob Docs`
    *   **Type**: `command` (æœ¬åœ°è¿è¡Œ) æˆ– `sse` (Docker è¿œç¨‹)
    
    **æ–¹å¼ A: Docker (SSE)**
    *   **Url**: `http://localhost:9000/`

    **æ–¹å¼ B: æœ¬åœ°è¿è¡Œ (SSE)**
    *   é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨æœåŠ¡ï¼š
        ```bash
        python src/server.py --port 9000 --transport sse --path /
        ```
    *   åœ¨ Cursor ä¸­å¡«å†™ï¼š
        *   **Url**: `http://localhost:9000/`

    **æ–¹å¼ C: æœ¬åœ°è¿è¡Œ (Command - ä¼ ç»Ÿæ¨¡å¼)**
    *   **Command**: `python /ç»å¯¹è·¯å¾„/to/easemob-doc-mcp/src/server.py`
    *   (æ³¨æ„ï¼šæ¨èä½¿ç”¨ SSE æ¨¡å¼ï¼Œå› ä¸ºå®ƒåœ¨å¤„ç†é•¿è¿æ¥å’Œå¤šæŸ¥è¯¢æ—¶æ›´ç¨³å®š)

### Claude Desktop ä½¿ç”¨

ä¿®æ”¹æ‚¨çš„ Claude é…ç½®æ–‡ä»¶ (`~/Library/Application Support/Claude/claude_desktop_config.json`)ï¼š

```json
{
  "mcpServers": {
    "easemob-docs": {
      "url": "https://mcp-servers.dujiepeng.top/"
    }
  }
}
```

## ğŸ§ª è°ƒè¯•ä¸éªŒè¯

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè°ƒè¯•è„šæœ¬ï¼Œå¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹æœç´¢æ•ˆæœï¼š

```bash
python debug_search.py
```

å®ƒä¼šæ¨¡æ‹Ÿå‡ æ¬¡æœç´¢è¯·æ±‚ï¼Œå¹¶å±•ç¤ºé«˜äº®ç»“æœã€‚

## ğŸ“¦ è¿™ä¸ªé¡¹ç›®åŒ…å«ä»€ä¹ˆï¼Ÿ

*   `src/server.py`: MCP æœåŠ¡å™¨æ ¸å¿ƒé€»è¾‘ã€‚
*   `src/indexer.py`: Whoosh æœç´¢å¼•æ“å°è£…ã€‚
*   `document/`, `uikit/`, `callkit/`: ç¯ä¿¡æŠ€æœ¯æ–‡æ¡£ï¼ˆéœ€ç¡®ä¿æœ¬åœ°åŒ…å«è¿™äº›ç›®å½•ï¼‰ã€‚
*   `indexdir/`: è‡ªåŠ¨ç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶ï¼ˆè¯·å‹¿æäº¤åˆ° Gitï¼‰ã€‚

## License

MIT